{"version":3,"file":"createMap-dec13cbe.js","sources":["../../src/lib/generateShortRandomId.js","../../src/lib/label-editor/labelsStorage.js","../../src/lib/label-editor/createDOMMarkerEditor.js","../../src/lib/label-editor/createLabelEditor.js","../../src/lib/createMap.js"],"sourcesContent":["export default function generateShortRandomId() {\n  return Math.random().toString(36).substr(2, 5);\n}","import config from '../config'\nimport generateShortRandomId from '../generateShortRandomId';\nimport bus from '../bus';\n\nlet originalPlaces;\nlet indexedPlaces = new Map();\n\nexport async function getPlaceLabels() {\n  let r = await fetch(config.placesSource, {mode: 'cors'})\n  originalPlaces = await r.json();\n  originalPlaces.features.forEach(f => {\n    indexedPlaces.set(f.properties.labelId, f);\n  });\n\n  const mergedLabels = mergePlacesWithLocalStorage(originalPlaces);\n  const hasChanges = checkOriginalPlacesForChanges(mergedLabels);\n  if (hasChanges) {\n    bus.fire('unsaved-changes-detected', hasChanges);\n  }\n  return mergedLabels;\n}\n\nfunction savePlaceLabels(places) {\n  localStorage.setItem('places', JSON.stringify(places));\n}\n\nexport function addLabelToPlaces(places, value, lngLat, mapZoomLevel, borderOwnerId) {\n  let labelId = generateShortRandomId();\n  while (indexedPlaces.has(labelId)) labelId = generateShortRandomId();\n\n  const label = {\n    type: 'Feature',\n    geometry: {type: 'Point', coordinates: [lngLat.lng, lngLat.lat].map(x => Math.round(x * 1000) / 1000)},\n    properties: {symbolzoom: Math.ceil(mapZoomLevel), name: value, labelId}\n  };\n  if (borderOwnerId !== undefined) {\n    label.properties.ownerId = borderOwnerId;\n  }\n  places.features.push(label);\n\n  indexedPlaces.set(labelId, label);\n  savePlaceLabels(places);\n  return places;\n}\n\nexport function editLabelInPlaces(labelId, places, value, lngLat, mapZoomLevel) {\n  if (!value) {\n    places.features = places.features.filter(f => f.properties.labelId !== labelId);\n    indexedPlaces.delete(labelId);\n  } else {\n    const labelToModify = places.features.find(f => f.properties.labelId === labelId);\n    labelToModify.properties.name = value;\n    labelToModify.properties.symbolzoom = Math.ceil(mapZoomLevel)\n    labelToModify.geometry.coordinates = [lngLat.lng, lngLat.lat].map(x => Math.round(x * 1000) / 1000);\n    indexedPlaces.set(labelId, labelToModify);\n  }\n\n  savePlaceLabels(places);\n  return places;\n}\n\nfunction mergePlacesWithLocalStorage() {\n  const savedPlaces = JSON.parse(localStorage.getItem('places')) || {type: \"FeatureCollection\", features: []};\n  let mergeIndex = new Map();\n  for (const savedPlace of savedPlaces.features) {\n    const placeKey = savedPlace.properties.labelId;\n    const place = mergeIndex.get(placeKey);\n    if (place) {\n      // local override:\n      mergeIndex.set(placeKey, Object.assign({}, place, savedPlace));\n    } else {\n      // local only:\n      mergeIndex.set(placeKey, savedPlace);\n    }\n  }\n\n  indexedPlaces.forEach((place, placeKey) => {\n    if (!mergeIndex.has(placeKey)) {\n      // remote only:\n      mergeIndex.set(placeKey, place);\n    }\n  });\n\n\n  return {\n    type: \"FeatureCollection\",\n    features: Array.from(mergeIndex.values())\n  };\n}\n\nfunction checkOriginalPlacesForChanges(mergedPlaces) {\n  if (!originalPlaces) return false;\n\n  for (const resolvedPlace of mergedPlaces.features) {\n    const placeKey = resolvedPlace.properties.labelId;\n    const place = indexedPlaces.get(placeKey);\n    if (!place) return true;\n    if (place.properties.name !== resolvedPlace.properties.name) return true;\n    if (place.properties.symbolzoom !== resolvedPlace.properties.symbolzoom) return true; \n    if (place.geometry.coordinates[0] !== resolvedPlace.geometry.coordinates[0]) return true;\n    if (place.geometry.coordinates[1] !== resolvedPlace.geometry.coordinates[1]) return true; \n  }\n\n  return false;\n}","\nexport default function createDOMarkerEditor(map, onSave, defaultText) {\n  const element = document.createElement('div');\n  element.className = 'label-marker';\n  element.innerHTML = `<form class=\"mini-label\">\n  <input type=\"text\" placeholder=\"Label\" />\n  <div class='commands'>\n    <a href='#' class=\"cancel\" tabindex=\"3\">Cancel</a>\n    <a href='#' class=\"accept\">Save</a>\n  </div>\n  </div>`;\n\n  if (defaultText) element.querySelector('input').value = defaultText;\n\n  let marker; \n  let startX = 0;\n  let startY = 0;\n  let dx = 0, dy = 0;\n\n  listenToEvents();\n\n  return {\n    element,\n    setMarker: (newMarker) => { marker = newMarker; },\n  }\n\n  function submit(e) {\n    e.preventDefault(); \n    onSave(element.querySelector('input').value);\n    close();\n  }\n\n  function listenToEvents() {\n    document.addEventListener('keydown', onKeyDown);\n    element.querySelector('form').addEventListener('submit', submit);\n    element.querySelector('.cancel').addEventListener('click', (e) => {\n      e.preventDefault();\n      close();\n    });\n\n    element.querySelector('.accept').addEventListener('click', (e) => {\n      submit(e);\n    });\n\n    element.addEventListener('pointerdown', (e) => {\n      startX = e.clientX; startY = e.clientY;\n      let markerCoordinates = map.project(marker.getLngLat());\n      dx = markerCoordinates.x - startX;\n      dy = markerCoordinates.y - startY;\n      window.addEventListener('pointermove', onPointerMove, true);\n      window.addEventListener('pointerup', cleanUp, true);\n    });\n  }\n\n  function onPointerMove(e) {\n    const newLngLat = map.unproject([e.clientX + dx, e.clientY + dy]);\n    marker.setLngLat(newLngLat);\n  }\n\n  function cleanUp() {\n    document.removeEventListener('keydown', onKeyDown);\n    window.removeEventListener('pointermove', onPointerMove, true);\n    window.removeEventListener('pointerup', cleanUp, true);\n  }\n\n  function close() {\n    marker.remove();\n    cleanUp();\n  }\n\n  function onKeyDown(e) {\n    if (e.key === 'Escape') {\n      close();\n      e.preventDefault();\n    }\n  }\n}","import maplibregl from 'maplibre-gl';\nimport {getPlaceLabels,  addLabelToPlaces, editLabelInPlaces} from './labelsStorage';\nimport createMarkerEditor from './createDOMMarkerEditor';\nimport bus from '../bus';\n\nexport default function createLabelEditor(map) {\n  let places;\n  const placeLabelLayers = ['place-country-1', 'place-country-1-enriched'];\n\n  getPlaceLabels().then(loadedPlaces => {\n    map.getSource('place').setData(loadedPlaces)\n    places = loadedPlaces;\n  });\n\n  return {\n    getContextMenuItems,\n    getPlaces: () => places\n  }\n\n  function getContextMenuItems(e, borderOwnerId) {\n    const activePlaceLabelLayers = placeLabelLayers.filter((layerId) => map.getLayer(layerId));\n    const labelFeature = activePlaceLabelLayers.length\n      ? map.queryRenderedFeatures(e.point, { layers: activePlaceLabelLayers })\n      : [];\n    let items = []\n    if (labelFeature.length) {\n      const label = labelFeature[0].properties;\n      items.push({\n        text: `Edit ${label.name}`,\n        click: () => editLabel(labelFeature[0].geometry.coordinates, label)\n      });\n    } else {\n      items.push({\n        text: 'Add label',\n        click: () => addLabel(e.lngLat, borderOwnerId)\n      });\n    }\n\n    return items;\n  }\n\n  function addLabel(lngLat, borderOwnerId) {\n    const markerEditor = createMarkerEditor(map, save);\n\n    const marker = new maplibregl.Popup({closeButton: false});\n    marker.setDOMContent(markerEditor.element);\n    marker.setLngLat(lngLat);\n    marker.addTo(map);\n\n    markerEditor.setMarker(marker);\n\n    function save(value) {\n      if (!value) return;\n      places = addLabelToPlaces(places, value, marker.getLngLat(), map.getZoom(), borderOwnerId);\n      map.getSource('place').setData(places);\n      bus.fire('unsaved-changes-detected', true);\n    }\n  }\n\n  function editLabel(lngLat, oldLabelProps) {\n    const markerEditor = createMarkerEditor(map, save, oldLabelProps.name);\n\n    const marker = new maplibregl.Popup({closeButton: false});\n    marker.setDOMContent(markerEditor.element);\n    marker.setLngLat(lngLat);\n    marker.addTo(map);\n\n    markerEditor.setMarker(marker);\n\n    function save(value) {\n      places = editLabelInPlaces(oldLabelProps.labelId, places, value, marker.getLngLat(), map.getZoom());\n      map.getSource('place').setData(places);\n      bus.fire('unsaved-changes-detected', true);\n    }\n  }\n}\n","import \"maplibre-gl/dist/maplibre-gl.css\";\nimport maplibregl from \"maplibre-gl\";\nimport bus from \"./bus\";\nimport config from \"./config\";\nimport {getCustomLayer} from \"./gl/createLinesCollection.js\";\nimport downloadGroupGraph from \"./downloadGroupGraph.js\";\nimport getComplimentaryColor from \"./getComplimentaryColor\";\nimport createLabelEditor from \"./label-editor/createLabelEditor\";\nimport getColorTheme from \"./getColorTheme\";\n// import { createRadialGradient } from './gl/createRadialGradient';\n\nconst primaryHighlightColor = \"#bf2072\";\nconst secondaryHighlightColor = \"#e56aaa\";\nconst bulkHighlightColor = \"#43bfa2\";\nconst enrichedRegionColor = \"#ffbe0b\";\nconst enrichedRegionLabelColor = \"#ffffff\";\nconst enrichedRegionLabelHaloColor = \"#186d59\";\nconst enrichedRegionLabelSizeScale = 1.7;\nconst fallbackPointSize = 5;\nconst placeCountryLayerId = \"place-country-1\";\nconst enrichedPlaceCountryLayerId = \"place-country-1-enriched\";\nconst restoreBeforeLayerId = \"persistent-selected-nodes-layer\";\n\nconst currentColorTheme = getColorTheme();\n\nconst colorStyle = [ \"case\" ]\ncurrentColorTheme.color.forEach((row) => {\n  colorStyle.push([\"==\", [\"get\", \"fill\"], row.input], row.output);\n})\ncolorStyle.push(\"#FF0000\");\n\nexport default function createMap() {\n  const map = new maplibregl.Map(getDefaultStyle());\n  map.dragRotate.disable();\n  map.touchZoomRotate.disableRotation();\n  const fastLinesLayer = getCustomLayer();\n  let backgroundEdgesFetch;\n  let labelEditor;\n  let persistentHighlightedFeatures = [];\n  let transientHighlightedFeatures = [];\n  let enrichedRegionFeatures = [];\n  let enrichedLabelOwnerIds = [];\n  let enrichedRegionRequestId = 0;\n  // collection of labels.\n\n  map.on(\"load\", () => {\n    map.addLayer(fastLinesLayer, \"circle-layer\");\n    // map.addLayer(createRadialGradient(), \"polygon-layer\");\n    labelEditor = createLabelEditor(map);\n    applyPersistentHighlights();\n    applyTransientHighlights();\n    applyEnrichedRegionHighlights();\n    applyEnrichedRegionLabelStyles();\n  });\n\n  map.on(\"contextmenu\", (e) => {\n    bus.fire(\"show-tooltip\");\n    \n    let bg = getBackgroundNearPoint(e.point);\n    if (!bg) return;\n\n    const contextMenuItems = { \n      items: labelEditor.getContextMenuItems(e, bg.id),\n      left: e.point.x + \"px\", \n      top: e.point.y + \"px\" \n    };\n\n    const nearestCity = findNearestCity(e.point);\n    if (nearestCity) {\n      let name = nearestCity.properties.label;\n      let parts = name.split('/')\n      const displayName = parts[parts.length - 1] || name;\n\n      contextMenuItems.items.push({\n        text: \"List connections of \" + displayName,\n        click: () => {\n          showDetails(nearestCity);\n          drawBackgroundEdges(e.point, name);\n          bus.fire('focus-on-repo', name, bg.id);\n        }\n      });\n    }\n\n    bus.fire(\"show-context-menu\", contextMenuItems);\n  });\n\n  map.on(\"mousemove\", () => {\n    // let hoveredFeature = findNearestCity(e.point);\n    // if (hoveredFeature) {\n    //   const bgFeature = getBackgroundNearPoint(e.point);\n    //   bus.fire(\"show-tooltip\", { \n    //     text: hoveredFeature.properties.label, \n    //     left: e.point.x + \"px\",\n    //     top: e.point.y + \"px\",\n    //     background: bgFeature?.properties?.fill || \"rgba(0,0,0,0.5)\",\n    //   });\n    // } else {\n    //   bus.fire(\"show-tooltip\");\n    // }\n  });\n\n  map.on(\"click\", (e) => {\n    bus.fire(\"show-context-menu\");\n    const nearestCity = findNearestCity(e.point);\n    if (!nearestCity) return;\n    const repo = nearestCity.properties.label\n    if (!repo) return;\n    showDetails(nearestCity);\n\n    const includeExternal = e.originalEvent.altKey;\n    drawBackgroundEdges(e.point, repo, !includeExternal);\n  });\n  const bordersCollection = fetch(config.bordersSource).then((res) => res.json());\n  const bordersIndex = bordersCollection.then((collection) => {\n    const features = Array.isArray(collection?.features) ? collection.features : [];\n    return features\n      .map((feature) => {\n        const ring = feature?.geometry?.coordinates?.[0];\n        if (!Array.isArray(ring) || !ring.length) return null;\n        const bbox = getRingBounds(ring);\n        return {\n          id: feature.id,\n          ring,\n          bbox\n        };\n      })\n      .filter(Boolean);\n  });\n\n  return {\n    map,\n    dispose() {\n      map.remove();\n      // TODO: Remove custom layer?\n    },\n    makeVisible,\n    focusOnNodes,\n    highlightNodes,\n    highlightRegions,\n    clearSelectionHighlights,\n    clearPersistentHighlights,\n    clearRegionHighlights,\n    clearHighlights,\n    getPlacesGeoJSON,\n    getGroupIdAt,\n    getGroupIdsAtCoordinates\n  }\n\n  function getGroupIdAt(lng, lat) {\n    const pointLng = Number(lng);\n    const pointLat = Number(lat);\n    if (!Number.isFinite(pointLng) || !Number.isFinite(pointLat)) {\n      return Promise.resolve(undefined);\n    }\n    return bordersIndex.then((index) => findGroupIdForPoint(index, pointLng, pointLat));\n  }\n\n  function getGroupIdsAtCoordinates(coordinates = []) {\n    if (!Array.isArray(coordinates) || !coordinates.length) {\n      return Promise.resolve([]);\n    }\n    return bordersIndex.then((index) => {\n      return coordinates.map((pair) => {\n        if (!Array.isArray(pair) || pair.length !== 2) return undefined;\n        const lng = Number(pair[0]);\n        const lat = Number(pair[1]);\n        if (!Number.isFinite(lng) || !Number.isFinite(lat)) return undefined;\n        return findGroupIdForPoint(index, lng, lat);\n      });\n    });\n  }\n\n  function findGroupIdForPoint(index = [], lng, lat) {\n    for (let i = 0; i < index.length; i += 1) {\n      const border = index[i];\n      if (!isPointInsideBounds(lng, lat, border.bbox)) continue;\n      if (polygonContainsPoint(border.ring, lng, lat)) {\n        return border.id;\n      }\n    }\n    return undefined;\n  }\n\n  function showDetails(nearestCity) {\n    const repo = nearestCity.properties.label\n    if (!repo) return;\n    const [lat, lon] = nearestCity.geometry.coordinates\n    bus.fire(\"show-tooltip\");\n    bus.fire(\"repo-selected\", {\n      text: repo,\n      lat,\n      lon,\n      groupId: nearestCity.properties?.parent\n    });\n  }\n\n  function getPlacesGeoJSON() {\n    return labelEditor.getPlaces();\n  }\n\n  function clearSelectionHighlights() {\n    backgroundEdgesFetch?.cancel();\n    fastLinesLayer.clear();\n    transientHighlightedFeatures = [];\n    applyTransientHighlights();\n  }\n\n  function clearPersistentHighlights() {\n    persistentHighlightedFeatures = [];\n    applyPersistentHighlights();\n  }\n\n  function clearRegionHighlights() {\n    enrichedRegionRequestId += 1;\n    enrichedRegionFeatures = [];\n    enrichedLabelOwnerIds = [];\n    applyEnrichedRegionHighlights();\n    applyEnrichedRegionLabelStyles();\n  }\n\n  function clearHighlights() {\n    backgroundEdgesFetch?.cancel();\n    fastLinesLayer.clear();\n    persistentHighlightedFeatures = [];\n    transientHighlightedFeatures = [];\n    enrichedRegionFeatures = [];\n    enrichedLabelOwnerIds = [];\n    enrichedRegionRequestId += 1;\n    applyPersistentHighlights();\n    applyTransientHighlights();\n    applyEnrichedRegionHighlights();\n    applyEnrichedRegionLabelStyles();\n  }\n\n  function makeVisible(repository, location, disableAnimation = false) {\n    const drawEdgesAtCurrentCenter = () => {\n      const projectedPoint = map.project(location.center);\n      drawBackgroundEdges(projectedPoint, repository);\n    };\n\n    if (disableAnimation) {\n      map.jumpTo(location);\n      drawEdgesAtCurrentCenter();\n      return;\n    }\n\n    map.once(\"moveend\", drawEdgesAtCurrentCenter);\n    map.flyTo(location);\n  }\n\n  function focusOnNodes(\n    nodes = [],\n    { padding = 80, maxZoom = 8, disableAnimation = false } = {}\n  ) {\n    const coordinates = nodes.map(getNodeCoordinates).filter(Boolean);\n    if (!coordinates.length) return;\n\n    let minLng = Infinity;\n    let minLat = Infinity;\n    let maxLng = -Infinity;\n    let maxLat = -Infinity;\n\n    coordinates.forEach(([lng, lat]) => {\n      if (lng < minLng) minLng = lng;\n      if (lat < minLat) minLat = lat;\n      if (lng > maxLng) maxLng = lng;\n      if (lat > maxLat) maxLat = lat;\n    });\n\n    if (minLng === maxLng && minLat === maxLat) {\n      const location = {\n        center: [minLng, minLat],\n        zoom: maxZoom\n      };\n      if (disableAnimation) {\n        map.jumpTo(location);\n      } else {\n        map.flyTo(location);\n      }\n      return;\n    }\n\n    const location = map.cameraForBounds(\n      [\n        [minLng, minLat],\n        [maxLng, maxLat]\n      ],\n      {\n        padding,\n        maxZoom\n      }\n    );\n    if (!location) return;\n\n    if (disableAnimation) {\n      map.jumpTo(location);\n    } else {\n      map.flyTo(location);\n    }\n  }\n\n  function getNodeCoordinates(node = {}) {\n    const coordinates = Array.isArray(node.coordinates)\n      ? node.coordinates\n      : [node.lat, node.lon];\n    if (!Array.isArray(coordinates) || coordinates.length !== 2) return null;\n\n    const lng = Number(coordinates[0]);\n    const lat = Number(coordinates[1]);\n    if (!Number.isFinite(lng) || !Number.isFinite(lat)) return null;\n    return [lng, lat];\n  }\n\n  function highlightNodes(nodes = []) {\n    backgroundEdgesFetch?.cancel();\n    fastLinesLayer.clear();\n    persistentHighlightedFeatures = nodes\n      .map((node) => {\n        const coordinates = getNodeCoordinates(node);\n        if (!coordinates) return null;\n        return {\n          type: \"Feature\",\n          geometry: { type: \"Point\", coordinates },\n          properties: {\n            color: node.color || bulkHighlightColor,\n            name: node.text || node.name || \"\",\n            background: node.background || \"#222\",\n            highlightKind: node.highlightKind || \"bulk\",\n            textSize: node.textSize || 0.8,\n            size: node.size || fallbackPointSize * 6\n          }\n        };\n      })\n      .filter(Boolean);\n\n    applyPersistentHighlights();\n  }\n\n  function applyPersistentHighlights() {\n    const source = map.getSource(\"persistent-selected-nodes\");\n    if (!source) return;\n\n    source.setData({\n      type: \"FeatureCollection\",\n      features: persistentHighlightedFeatures\n    });\n    map.redraw();\n  }\n\n  function applyTransientHighlights() {\n    const source = map.getSource(\"selected-nodes\");\n    if (!source) return;\n\n    source.setData({\n      type: \"FeatureCollection\",\n      features: transientHighlightedFeatures\n    });\n    map.redraw();\n  }\n\n  function applyEnrichedRegionHighlights() {\n    const source = map.getSource(\"enriched-regions\");\n    if (!source) return;\n\n    source.setData({\n      type: \"FeatureCollection\",\n      features: enrichedRegionFeatures\n    });\n    map.redraw();\n  }\n\n  function highlightRegions(groupIds = []) {\n    const uniqueGroupIds = new Set(\n      (Array.isArray(groupIds) ? groupIds : [])\n        .filter((id) => id !== undefined && id !== null)\n        .map((id) => String(id))\n    );\n    const requestId = ++enrichedRegionRequestId;\n\n    if (!uniqueGroupIds.size) {\n      enrichedRegionFeatures = [];\n      enrichedLabelOwnerIds = [];\n      applyEnrichedRegionHighlights();\n      applyEnrichedRegionLabelStyles();\n      return;\n    }\n    enrichedLabelOwnerIds = Array.from(uniqueGroupIds);\n    applyEnrichedRegionLabelStyles();\n\n    bordersCollection\n      .then((collection) => {\n        if (requestId !== enrichedRegionRequestId) return;\n        const features = Array.isArray(collection?.features) ? collection.features : [];\n        enrichedRegionFeatures = features.filter((feature) =>\n          uniqueGroupIds.has(String(feature?.id))\n        );\n        applyEnrichedRegionHighlights();\n      })\n      .catch((error) => {\n        if (requestId !== enrichedRegionRequestId) return;\n        console.error(error);\n        enrichedRegionFeatures = [];\n        enrichedLabelOwnerIds = [];\n        applyEnrichedRegionHighlights();\n        applyEnrichedRegionLabelStyles();\n      });\n  }\n\n  function applyEnrichedRegionLabelStyles() {\n    if (!map.getLayer(placeCountryLayerId)) return;\n\n    const baseSizeExpression = getPlaceCountryLabelBaseTextSizeExpression();\n    const baseFilterExpression = getPlaceCountryLabelBaseFilterExpression();\n    const hasEnrichedLabels = enrichedLabelOwnerIds.length > 0;\n    const isEnrichedExpression = getEnrichedOwnerIdConditionExpression(enrichedLabelOwnerIds);\n    const baseFilterForDefaultLayer = hasEnrichedLabels\n      ? [\"all\", baseFilterExpression, [\"!\", isEnrichedExpression]]\n      : baseFilterExpression;\n\n    if (map.getLayer(restoreBeforeLayerId)) {\n      map.moveLayer(placeCountryLayerId, restoreBeforeLayerId);\n    }\n    map.setLayerZoomRange(placeCountryLayerId, 0, 10);\n    map.setFilter(placeCountryLayerId, baseFilterForDefaultLayer);\n    map.setLayoutProperty(placeCountryLayerId, \"text-size\", baseSizeExpression);\n    map.setLayoutProperty(placeCountryLayerId, \"text-allow-overlap\", false);\n    map.setLayoutProperty(placeCountryLayerId, \"text-ignore-placement\", false);\n    map.setPaintProperty(placeCountryLayerId, \"text-color\", currentColorTheme.placeLabelsColor);\n    map.setPaintProperty(placeCountryLayerId, \"text-halo-color\", currentColorTheme.placeLabelsHaloColor);\n    map.setPaintProperty(placeCountryLayerId, \"text-halo-width\", currentColorTheme.placeLabelsHaloWidth);\n\n    if (!hasEnrichedLabels) {\n      removeEnrichedPlaceCountryLayer();\n      return;\n    }\n\n    ensureEnrichedPlaceCountryLayer();\n    if (!map.getLayer(enrichedPlaceCountryLayerId)) return;\n\n    map.setLayerZoomRange(enrichedPlaceCountryLayerId, 0, 24);\n    map.setFilter(enrichedPlaceCountryLayerId, isEnrichedExpression);\n    map.setLayoutProperty(\n      enrichedPlaceCountryLayerId,\n      \"text-size\",\n      getPlaceCountryLabelBaseTextSizeExpression(enrichedRegionLabelSizeScale)\n    );\n    map.setLayoutProperty(enrichedPlaceCountryLayerId, \"text-allow-overlap\", true);\n    map.setLayoutProperty(enrichedPlaceCountryLayerId, \"text-ignore-placement\", true);\n    map.setPaintProperty(enrichedPlaceCountryLayerId, \"text-color\", enrichedRegionLabelColor);\n    map.setPaintProperty(enrichedPlaceCountryLayerId, \"text-halo-color\", enrichedRegionLabelHaloColor);\n    map.setPaintProperty(\n      enrichedPlaceCountryLayerId,\n      \"text-halo-width\",\n      getEnrichedPlaceLabelHaloWidth()\n    );\n    map.moveLayer(enrichedPlaceCountryLayerId);\n  }\n\n  function ensureEnrichedPlaceCountryLayer() {\n    if (map.getLayer(enrichedPlaceCountryLayerId)) return;\n\n    const layerDefinition = {\n      id: enrichedPlaceCountryLayerId,\n      type: \"symbol\",\n      source: \"place\",\n      layout: {\n        \"text-font\": [ \"Roboto Condensed Regular\" ],\n        \"text-size\": getPlaceCountryLabelBaseTextSizeExpression(),\n        \"symbol-sort-key\": [\"get\", \"symbolzoom\"],\n        \"text-field\": \"{name}\",\n        \"text-max-width\": 6,\n        \"text-line-height\": 1.1,\n        \"text-letter-spacing\": 0,\n        \"text-allow-overlap\": true,\n        \"text-ignore-placement\": true\n      },\n      paint: {\n        \"text-color\": enrichedRegionLabelColor,\n        \"text-halo-color\": enrichedRegionLabelHaloColor,\n        \"text-halo-width\": getEnrichedPlaceLabelHaloWidth()\n      }\n    };\n\n    if (map.getLayer(restoreBeforeLayerId)) {\n      map.addLayer(layerDefinition, restoreBeforeLayerId);\n      return;\n    }\n\n    map.addLayer(layerDefinition);\n  }\n\n  function removeEnrichedPlaceCountryLayer() {\n    if (!map.getLayer(enrichedPlaceCountryLayerId)) return;\n    map.removeLayer(enrichedPlaceCountryLayerId);\n  }\n\n  function getBackgroundNearPoint(point) {\n    const borderFeature = map.queryRenderedFeatures(point, { layers: [\"polygon-layer\"] });\n    return borderFeature[0];\n  }\n\n  function drawBackgroundEdges(point, repo, ignoreExternal = true) {\n    const bgFeature = getBackgroundNearPoint(point);\n    if (!bgFeature) return;\n    const groupId = bgFeature.id;\n    if (groupId === undefined) return;\n\n    const fillColor = getPolygonFillColor(bgFeature.properties);\n    let complimentaryColor = getComplimentaryColor(fillColor);\n    fastLinesLayer.clear();\n    backgroundEdgesFetch?.cancel();\n    let isCancelled = false;\n    let highlightedNodes = {\n      type: \"FeatureCollection\",\n      features: []\n    };\n\n    backgroundEdgesFetch = downloadGroupGraph(groupId).then(groupGraph => {\n      if (isCancelled) return;\n      let firstLevelLinks = [];\n      let primaryNodePosition;\n      let renderedNodesAdjustment = new Map();\n      map.querySourceFeatures(\"points-source\", {\n        sourceLayer: \"points\",\n        filter: [\"==\", \"parent\", groupId]\n      }).forEach(repo => {\n        const lngLat = repo.geometry.coordinates;\n        const size = Number(repo.properties.size);\n        renderedNodesAdjustment.set(repo.properties.label, {\n          lngLat,\n          size: Number.isFinite(size) && size > 0 ? size : fallbackPointSize\n        });\n      });\n\n      const getFallbackSize = (nodeId) => {\n        const graphNodeData = groupGraph.getNode(nodeId)?.data || {};\n        const size = Number(graphNodeData.size ?? graphNodeData.s);\n        return Number.isFinite(size) && size > 0 ? size : fallbackPointSize;\n      };\n\n      groupGraph.forEachLink(link => {\n        if (link.data?.e && ignoreExternal) return; // external;\n        const fromNodeData = renderedNodesAdjustment.get(link.fromId) || {\n          lngLat: groupGraph.getNode(link.fromId).data.l,\n          size: getFallbackSize(link.fromId)\n        };\n        const toNodeData = renderedNodesAdjustment.get(link.toId) || {\n          lngLat: groupGraph.getNode(link.toId).data.l,\n          size: getFallbackSize(link.toId)\n        };\n        const fromGeo = fromNodeData.lngLat;\n        const toGeo = toNodeData.lngLat;\n\n        const from = maplibregl.MercatorCoordinate.fromLngLat(fromGeo);\n        const to = maplibregl.MercatorCoordinate.fromLngLat(toGeo);\n        const isFirstLevel = repo === link.fromId || repo === link.toId;\n        const line = {\n          from: [from.x, from.y],\n          to: [to.x, to.y],\n          color: isFirstLevel ? 0xffffffFF : complimentaryColor \n        }\n        // delay first level links to be drawn last, so that they are on the top\n        if (isFirstLevel) {\n          firstLevelLinks.push(line);\n\n          if (!primaryNodePosition) {\n            primaryNodePosition = repo === link.fromId ? fromGeo : toGeo;\n            const primaryNodeSize = repo === link.fromId ? fromNodeData.size : toNodeData.size;\n            highlightedNodes.features.push({\n              type: \"Feature\",\n              geometry: {type: \"Point\", coordinates: primaryNodePosition},\n              properties: {color: primaryHighlightColor, name: repo, background: fillColor, highlightKind: \"click\", textSize: 1.2, size: primaryNodeSize}\n            });\n          } \n          let otherName = repo === link.fromId ? link.toId : link.fromId;\n          const otherNodeSize = repo === link.fromId ? toNodeData.size : fromNodeData.size;\n          // pick the other one too:\n          highlightedNodes.features.push({\n            type: \"Feature\",\n            geometry: {type: \"Point\", coordinates: repo === link.fromId ? toGeo : fromGeo},\n            properties: {color: secondaryHighlightColor, name: otherName, background: fillColor, highlightKind: \"click\", textSize: 0.8, size: otherNodeSize}\n          });\n        } else fastLinesLayer.addLine(line);\n      });\n      firstLevelLinks.forEach(line => {\n        fastLinesLayer.addLine(line)\n      });\n      transientHighlightedFeatures = highlightedNodes.features;\n      applyTransientHighlights();\n    });\n    backgroundEdgesFetch.cancel = () => {isCancelled = true};\n  }\n\n  function findNearestCity(point) {\n    let width = 16;\n    let height = 16;\n    const features = map.queryRenderedFeatures([\n      [point.x - width / 2, point.y - height / 2],\n      [point.x + width / 2, point.y + height / 2]\n    ], { layers: [\"circle-layer\"] });\n    if (!features.length) return;\n    let distance = Infinity;\n    let nearestCity = null;\n    features.forEach(feature => {\n      let geometry = feature.geometry.coordinates;\n      let dx = geometry[0] - point.x;\n      let dy = geometry[1] - point.y;\n      let d = dx * dx + dy * dy;\n      if (d < distance) {\n        distance = d;\n        nearestCity = feature;\n      }\n    });\n    return nearestCity;\n  }\n}\n\nfunction getDefaultStyle() {\n  return {\n    hash: true,\n    container: \"map\",\n    center: [0, 0],\n    zoom: 2,\n    style: {\n      version: 8,\n      glyphs: config.glyphsSource,\n      sources: {\n        \"borders-source\": { type: \"geojson\", data: config.bordersSource, },\n        \"points-source\": {\n          type: \"vector\",\n          tiles: [config.vectorTilesTiles],\n          //was minzoom 4 which would hide some points/proteins at high zoom levels\n          minzoom: 3,\n          maxzoom: 5,\n          center: [-9.843750,4.213679,7],\n        },\n        \"place\": { // this one loaded asynchronously, and merged with local storage data\n          type: \"geojson\",\n          data: {\n            type: \"FeatureCollection\",\n            features: []\n          }\n        },\n        \"selected-nodes\": {\n          type: \"geojson\",\n          data: {\n            type: \"FeatureCollection\",\n            features: [] \n          }\n        },\n        \"persistent-selected-nodes\": {\n          type: \"geojson\",\n          data: {\n            type: \"FeatureCollection\",\n            features: []\n          }\n        },\n        \"enriched-regions\": {\n          type: \"geojson\",\n          data: {\n            type: \"FeatureCollection\",\n            features: []\n          }\n        }\n      },\n      layers: [\n        {\n        \"id\": \"background\",\n        \"type\": \"background\",\n        \"paint\": {\n          \"background-color\": currentColorTheme.background\n        }\n      },\n        {\n          \"id\": \"polygon-layer\",\n          \"type\": \"fill\",\n          \"source\": \"borders-source\",\n          \"filter\": [\"==\", \"$type\", \"Polygon\"],\n          \"paint\": {\n            \"fill-color\": colorStyle\n          }\n        },\n        {\n          \"id\": \"enriched-regions-line-underlay\",\n          \"type\": \"line\",\n          \"source\": \"enriched-regions\",\n          \"paint\": {\n            \"line-color\": enrichedRegionColor,\n            \"line-width\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              3, 1.0,\n              8, 1.6,\n              14, 3.0\n            ],\n            \"line-opacity\": 0.7\n          }\n        },\n        {\n          \"id\": \"border-highlight\",\n          \"type\": \"line\",\n          \"source\": \"borders-source\",\n          \"layout\": {\n            \"visibility\": \"none\"\n          },\n          \"paint\": {\n            \"line-color\": \"#FFF\",\n            \"line-width\": 4,\n          }\n        },\n        {\n          \"id\": \"circle-layer\",\n          \"type\": \"circle\",\n          \"source\": \"points-source\",\n          \"source-layer\": \"points\",\n          \"filter\": [\"==\", \"$type\", \"Point\"],\n          \"paint\": {\n            \"circle-color\": currentColorTheme.circleColor,\n            \"circle-opacity\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              5, 0.1,\n              15, 0.9\n            ],\n            \"circle-stroke-color\": currentColorTheme.circleStrokeColor,\n            \"circle-stroke-width\": 1,\n            \"circle-stroke-opacity\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              8, 0.0,\n              15, 0.9\n            ],\n            \"circle-radius\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              5,  [\"*\", [\"get\", \"size\"], .1],\n              23, [\"*\", [\"get\", \"size\"], 1.5],\n            ]\n          }\n        },\n        {\n          \"id\": \"label-layer\",\n          \"type\": \"symbol\",\n          \"source\": \"points-source\",\n          \"source-layer\": \"points\",\n          \"filter\": [\">=\", [\"zoom\"], 5],\n          \"layout\": {\n            \"text-font\": [ \"Roboto Condensed Regular\" ],\n            \"text-field\": [\"slice\", [\"get\", \"label\"], [\"+\", [\"index-of\", \"/\", [\"get\", \"label\"]], 1]],\n            \"text-anchor\": \"top\",\n            \"text-max-width\": 10,\n            \"symbol-sort-key\": [\"-\", 0, [\"get\", \"size\"]],\n            \"symbol-spacing\": 500,\n            \"text-offset\": [0, 0.5],\n            \"text-size\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              8,  [\"/\", [\"get\", \"size\"], 4],\n              10, [\"+\", [\"get\", \"size\"], 8]\n            ],\n          },\n          \"paint\": {\n            \"text-color\": currentColorTheme.circleLabelsColor,\n            \"text-halo-color\": currentColorTheme.circleLabelsHaloColor,\n            \"text-halo-width\": currentColorTheme.circleLabelsHaloWidth,\n          },\n        }, \n        {\n          \"id\": \"selected-nodes-layer\",\n          \"type\": \"circle\",\n          \"source\": \"selected-nodes\",\n          \"paint\": {\n            \"circle-color\": [\"get\", \"color\"],\n            \"circle-radius\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              0, [\"max\", 3, [\"*\", [\"get\", \"size\"], 0.2]],\n              5, [\"max\", 4, [\"*\", [\"get\", \"size\"], 0.25]],\n              23, [\"*\", [\"get\", \"size\"], 1.6],\n            ],\n            \"circle-stroke-color\": \"#ffffff\",\n            \"circle-stroke-width\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              0, 0.5,\n              8, 1.5,\n              15, 2\n            ],\n            \"circle-stroke-opacity\": 0.9\n          }\n        },\n        {\n          \"id\": \"selected-nodes-labels-layer\",\n          \"type\": \"symbol\",\n          \"source\": \"selected-nodes\",\n          \"layout\": {\n            \"text-font\": [ \"Roboto Condensed Regular\" ],\n            \"text-field\": [\"get\", \"name\"],\n            \"text-anchor\": \"top\",\n            \"text-max-width\": 10,\n            \"symbol-sort-key\": [\"-\", 0, [\"get\", \"textSize\"]],\n            \"symbol-spacing\": 500,\n            \"text-offset\": [0, 0.5],\n            \"text-size\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              0, [\"max\", 8, [\"/\", [\"get\", \"size\"], 2.5]],\n              8, [\"/\", [\"get\", \"size\"], 4],\n              10, [\"+\", [\"get\", \"size\"], 8]\n            ],\n          },\n          \"paint\": {\n            \"text-color\": \"#fff\",\n            \"text-halo-color\": [\"get\", \"color\"],\n            \"text-halo-width\": 2,\n          },\n        },\n        // TODO: move labels stuff to label editor?\n{\n    \"id\": \"place-country-1\",\n    // minzoom: 1, \n    \"maxzoom\": 10,\n    \"type\": \"symbol\",\n    \"source\": \"place\",\n    \"layout\": {\n        \"text-font\": [ \"Roboto Condensed Bold\" ],\n        \"text-size\": getPlaceCountryLabelBaseTextSizeExpression(),\n        \"symbol-sort-key\": [\"get\", \"symbolzoom\"],\n        \"text-field\": \"{name}\",\n        \"text-max-width\": 6,\n        \"text-line-height\": 1.1,\n        \"text-letter-spacing\": 0,\n    },\n    \"paint\": {\n      \"text-color\": currentColorTheme.placeLabelsColor,\n      \"text-halo-color\": currentColorTheme.placeLabelsHaloColor,\n      \"text-halo-width\": currentColorTheme.placeLabelsHaloWidth,\n    },\n    \"filter\": getPlaceCountryLabelBaseFilterExpression(),\n},\n        {\n          \"id\": \"persistent-selected-nodes-layer\",\n          \"type\": \"circle\",\n          \"source\": \"persistent-selected-nodes\",\n          \"paint\": {\n            \"circle-color\": [\"get\", \"color\"],\n            \"circle-radius\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              0, [\"max\", 3, [\"*\", [\"get\", \"size\"], 0.2]],\n              5, [\"max\", 4, [\"*\", [\"get\", \"size\"], 0.25]],\n              23, [\"*\", [\"get\", \"size\"], 1.6],\n            ],\n            \"circle-stroke-color\": \"#ffffff\",\n            \"circle-stroke-width\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              0, 0.5,\n              8, 1.5,\n              15, 2\n            ],\n            \"circle-stroke-opacity\": 0.9\n          }\n        },\n        {\n          \"id\": \"persistent-selected-nodes-labels-layer\",\n          \"type\": \"symbol\",\n          \"source\": \"persistent-selected-nodes\",\n          \"layout\": {\n            \"text-font\": [ \"Roboto Condensed Regular\" ],\n            \"text-field\": [\"get\", \"name\"],\n            \"text-anchor\": \"top\",\n            \"text-max-width\": 10,\n            \"symbol-sort-key\": [\"-\", 0, [\"get\", \"textSize\"]],\n            \"symbol-spacing\": 500,\n            \"text-offset\": [0, 0.5],\n            \"text-allow-overlap\": true,\n            \"text-size\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              0, [\"max\", 6, [\"/\", [\"get\", \"size\"], 3]],\n              5, [\"max\", 7, [\"/\", [\"get\", \"size\"], 2.6]],\n              8, [\"max\", 9, [\"/\", [\"get\", \"size\"], 2.2]],\n              10, [\"max\", 12, [\"*\", [\"get\", \"size\"], 0.6]],\n              14, [\"*\", [\"get\", \"size\"], 1.0]\n            ],\n          },\n          \"paint\": {\n            \"text-color\": \"#fff\",\n            \"text-halo-color\": [\"get\", \"color\"],\n            \"text-halo-width\": 3,\n          },\n        },\n        {\n          \"id\": \"enriched-regions-top-line\",\n          \"type\": \"line\",\n          \"source\": \"enriched-regions\",\n          \"layout\": {\n            \"line-join\": \"round\",\n            \"line-cap\": \"round\"\n          },\n          \"paint\": {\n            \"line-color\": \"#fff7cf\",\n            \"line-width\": [\n              \"interpolate\",\n              [\"linear\"],\n              [\"zoom\"],\n              2, 1.4,\n              6, 2.6,\n              10, 4.0,\n              14, 5.8\n            ],\n            \"line-opacity\": 0.95\n          }\n        }\n      ]\n    },\n  };\n}\n\nfunction getPolygonFillColor(polygonProperties) {\n  for (const color of currentColorTheme.color) {\n    if (color.input === polygonProperties.fill) {\n      return color.output;\n    }\n  }\n  return polygonProperties.fill;\n}\n\nfunction getRingBounds(ring = []) {\n  let minLng = Infinity;\n  let minLat = Infinity;\n  let maxLng = -Infinity;\n  let maxLat = -Infinity;\n\n  ring.forEach((point) => {\n    if (!Array.isArray(point) || point.length < 2) return;\n    const lng = Number(point[0]);\n    const lat = Number(point[1]);\n    if (!Number.isFinite(lng) || !Number.isFinite(lat)) return;\n    if (lng < minLng) minLng = lng;\n    if (lat < minLat) minLat = lat;\n    if (lng > maxLng) maxLng = lng;\n    if (lat > maxLat) maxLat = lat;\n  });\n\n  return [minLng, minLat, maxLng, maxLat];\n}\n\nfunction isPointInsideBounds(lng, lat, bounds = []) {\n  if (!Array.isArray(bounds) || bounds.length !== 4) return false;\n  return lng >= bounds[0] && lng <= bounds[2] && lat >= bounds[1] && lat <= bounds[3];\n}\n\nfunction getEnrichedOwnerIdConditionExpression(ownerIds = []) {\n  return [\n    \"in\",\n    [\"to-string\", [\"get\", \"ownerId\"]],\n    [\"literal\", ownerIds]\n  ];\n}\n\nfunction getPlaceCountryLabelBaseTextSizeExpression(scale = 1) {\n  const textScale = Number.isFinite(scale) && scale > 0 ? scale : 1;\n  return [\n    \"interpolate\",\n    [ \"cubic-bezier\", 0.2, 0, 0.7, 1 ],\n    [\"zoom\"],\n    1, [\n      \"*\",\n      textScale,\n      [\n        \"step\",\n        [\"get\", \"symbolzoom\"], 15,\n        4, 13,\n        5, 12\n      ]\n    ],\n    9, [\n      \"*\",\n      textScale,\n      [\n        \"step\",\n        [\"get\", \"symbolzoom\"], 22,\n        4, 19,\n        5, 17\n      ]\n    ]\n  ];\n}\n\nfunction getPlaceCountryLabelBaseFilterExpression() {\n  return [\n    \"<=\",\n    [\"get\", \"symbolzoom\"],\n    [\"+\", [\"zoom\"], 4]\n  ];\n}\n\nfunction getEnrichedPlaceLabelHaloWidth() {\n  return Math.max(1.3, currentColorTheme.placeLabelsHaloWidth + 0.35);\n}\n\nfunction pointOnSegment(px, py, x1, y1, x2, y2, epsilon = 1e-9) {\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  const cross = (px - x1) * dy - (py - y1) * dx;\n  if (Math.abs(cross) > epsilon) return false;\n\n  const minX = Math.min(x1, x2) - epsilon;\n  const maxX = Math.max(x1, x2) + epsilon;\n  const minY = Math.min(y1, y2) - epsilon;\n  const maxY = Math.max(y1, y2) + epsilon;\n  return px >= minX && px <= maxX && py >= minY && py <= maxY;\n}\n\nfunction polygonContainsPoint(ring, pX, pY) {\n    let c = false;\n    for (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {\n        const p1 = ring[i];\n        const p2 = ring[j];\n        if (pointOnSegment(pX, pY, p1[0], p1[1], p2[0], p2[1])) {\n            return true;\n        }\n        if (((p1[1] > pY) !== (p2[1] > pY)) && (pX < (p2[0] - p1[0]) * (pY - p1[1]) / (p2[1] - p1[1]) + p1[0])) {\n            c = !c;\n        }\n    }\n    return c;\n}\n"],"names":["generateShortRandomId","originalPlaces","indexedPlaces","getPlaceLabels","config","f","mergedLabels","mergePlacesWithLocalStorage","hasChanges","checkOriginalPlacesForChanges","bus","savePlaceLabels","places","addLabelToPlaces","value","lngLat","mapZoomLevel","borderOwnerId","labelId","label","x","editLabelInPlaces","labelToModify","savedPlaces","mergeIndex","savedPlace","placeKey","place","mergedPlaces","resolvedPlace","createDOMarkerEditor","map","onSave","defaultText","element","marker","startX","startY","dx","dy","listenToEvents","newMarker","submit","e","close","onKeyDown","markerCoordinates","onPointerMove","cleanUp","newLngLat","createLabelEditor","placeLabelLayers","loadedPlaces","getContextMenuItems","activePlaceLabelLayers","layerId","labelFeature","items","editLabel","addLabel","markerEditor","createMarkerEditor","save","maplibregl","oldLabelProps","primaryHighlightColor","secondaryHighlightColor","bulkHighlightColor","enrichedRegionColor","enrichedRegionLabelColor","enrichedRegionLabelHaloColor","enrichedRegionLabelSizeScale","fallbackPointSize","placeCountryLayerId","enrichedPlaceCountryLayerId","restoreBeforeLayerId","currentColorTheme","getColorTheme","colorStyle","row","createMap","getDefaultStyle","fastLinesLayer","getCustomLayer","backgroundEdgesFetch","labelEditor","persistentHighlightedFeatures","transientHighlightedFeatures","enrichedRegionFeatures","enrichedLabelOwnerIds","enrichedRegionRequestId","applyPersistentHighlights","applyTransientHighlights","applyEnrichedRegionHighlights","applyEnrichedRegionLabelStyles","bg","getBackgroundNearPoint","contextMenuItems","nearestCity","findNearestCity","name","parts","displayName","showDetails","drawBackgroundEdges","repo","includeExternal","bordersCollection","res","bordersIndex","collection","feature","ring","_b","_a","bbox","getRingBounds","makeVisible","focusOnNodes","highlightNodes","highlightRegions","clearSelectionHighlights","clearPersistentHighlights","clearRegionHighlights","clearHighlights","getPlacesGeoJSON","getGroupIdAt","getGroupIdsAtCoordinates","lng","lat","pointLng","pointLat","index","findGroupIdForPoint","coordinates","pair","border","isPointInsideBounds","polygonContainsPoint","lon","repository","location","disableAnimation","drawEdgesAtCurrentCenter","projectedPoint","nodes","padding","maxZoom","getNodeCoordinates","minLng","minLat","maxLng","maxLat","node","source","groupIds","uniqueGroupIds","id","requestId","error","baseSizeExpression","getPlaceCountryLabelBaseTextSizeExpression","baseFilterExpression","getPlaceCountryLabelBaseFilterExpression","hasEnrichedLabels","isEnrichedExpression","getEnrichedOwnerIdConditionExpression","baseFilterForDefaultLayer","removeEnrichedPlaceCountryLayer","ensureEnrichedPlaceCountryLayer","getEnrichedPlaceLabelHaloWidth","layerDefinition","point","ignoreExternal","bgFeature","groupId","fillColor","getPolygonFillColor","complimentaryColor","getComplimentaryColor","isCancelled","highlightedNodes","downloadGroupGraph","groupGraph","firstLevelLinks","primaryNodePosition","renderedNodesAdjustment","size","getFallbackSize","nodeId","graphNodeData","link","fromNodeData","toNodeData","fromGeo","toGeo","from","to","isFirstLevel","line","primaryNodeSize","otherName","otherNodeSize","width","height","features","distance","geometry","d","polygonProperties","color","bounds","ownerIds","scale","textScale","pointOnSegment","px","py","x1","y1","x2","y2","epsilon","cross","minX","maxX","minY","maxY","pX","pY","c","i","j","p1","p2"],"mappings":"4JAAe,SAASA,IAAwB,CAC9C,OAAO,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,CAC/C,CCEA,IAAIC,EACAC,EAAgB,IAAI,IAEjB,eAAeC,IAAiB,CAErCF,EAAiB,MADT,MAAM,MAAMG,EAAO,aAAc,CAAC,KAAM,MAAM,CAAC,GAC9B,OACzBH,EAAe,SAAS,QAAQI,GAAK,CACnCH,EAAc,IAAIG,EAAE,WAAW,QAASA,CAAC,CAC7C,CAAG,EAED,MAAMC,EAAeC,GAA0C,EACzDC,EAAaC,GAA8BH,CAAY,EAC7D,OAAIE,GACFE,EAAI,KAAK,2BAA4BF,CAAU,EAE1CF,CACT,CAEA,SAASK,GAAgBC,EAAQ,CAC/B,aAAa,QAAQ,SAAU,KAAK,UAAUA,CAAM,CAAC,CACvD,CAEO,SAASC,GAAiBD,EAAQE,EAAOC,EAAQC,EAAcC,EAAe,CACnF,IAAIC,EAAUlB,KACd,KAAOE,EAAc,IAAIgB,CAAO,GAAGA,EAAUlB,GAAqB,EAElE,MAAMmB,EAAQ,CACZ,KAAM,UACN,SAAU,CAAC,KAAM,QAAS,YAAa,CAACJ,EAAO,IAAKA,EAAO,GAAG,EAAE,IAAIK,GAAK,KAAK,MAAMA,EAAI,GAAI,EAAI,GAAI,CAAC,EACrG,WAAY,CAAC,WAAY,KAAK,KAAKJ,CAAY,EAAG,KAAMF,EAAO,QAAAI,CAAO,CAC1E,EACE,OAAID,IAAkB,SACpBE,EAAM,WAAW,QAAUF,GAE7BL,EAAO,SAAS,KAAKO,CAAK,EAE1BjB,EAAc,IAAIgB,EAASC,CAAK,EAChCR,GAAgBC,CAAM,EACfA,CACT,CAEO,SAASS,GAAkBH,EAASN,EAAQE,EAAOC,EAAQC,EAAc,CAC9E,GAAI,CAACF,EACHF,EAAO,SAAWA,EAAO,SAAS,OAAOP,GAAKA,EAAE,WAAW,UAAYa,CAAO,EAC9EhB,EAAc,OAAOgB,CAAO,MACvB,CACL,MAAMI,EAAgBV,EAAO,SAAS,KAAKP,GAAKA,EAAE,WAAW,UAAYa,CAAO,EAChFI,EAAc,WAAW,KAAOR,EAChCQ,EAAc,WAAW,WAAa,KAAK,KAAKN,CAAY,EAC5DM,EAAc,SAAS,YAAc,CAACP,EAAO,IAAKA,EAAO,GAAG,EAAE,IAAIK,GAAK,KAAK,MAAMA,EAAI,GAAI,EAAI,GAAI,EAClGlB,EAAc,IAAIgB,EAASI,CAAa,CACzC,CAED,OAAAX,GAAgBC,CAAM,EACfA,CACT,CAEA,SAASL,IAA8B,CACrC,MAAMgB,EAAc,KAAK,MAAM,aAAa,QAAQ,QAAQ,CAAC,GAAK,CAAC,KAAM,oBAAqB,SAAU,CAAE,CAAA,EAC1G,IAAIC,EAAa,IAAI,IACrB,UAAWC,KAAcF,EAAY,SAAU,CAC7C,MAAMG,EAAWD,EAAW,WAAW,QACjCE,EAAQH,EAAW,IAAIE,CAAQ,EACjCC,EAEFH,EAAW,IAAIE,EAAU,OAAO,OAAO,GAAIC,EAAOF,CAAU,CAAC,EAG7DD,EAAW,IAAIE,EAAUD,CAAU,CAEtC,CAED,OAAAvB,EAAc,QAAQ,CAACyB,EAAOD,IAAa,CACpCF,EAAW,IAAIE,CAAQ,GAE1BF,EAAW,IAAIE,EAAUC,CAAK,CAEpC,CAAG,EAGM,CACL,KAAM,oBACN,SAAU,MAAM,KAAKH,EAAW,OAAM,CAAE,CAC5C,CACA,CAEA,SAASf,GAA8BmB,EAAc,CACnD,GAAI,CAAC3B,EAAgB,MAAO,GAE5B,UAAW4B,KAAiBD,EAAa,SAAU,CACjD,MAAMF,EAAWG,EAAc,WAAW,QACpCF,EAAQzB,EAAc,IAAIwB,CAAQ,EAKxC,GAJI,CAACC,GACDA,EAAM,WAAW,OAASE,EAAc,WAAW,MACnDF,EAAM,WAAW,aAAeE,EAAc,WAAW,YACzDF,EAAM,SAAS,YAAY,CAAC,IAAME,EAAc,SAAS,YAAY,CAAC,GACtEF,EAAM,SAAS,YAAY,CAAC,IAAME,EAAc,SAAS,YAAY,CAAC,EAAG,MAAO,EACrF,CAED,MAAO,EACT,CCvGe,SAASC,GAAqBC,EAAKC,EAAQC,EAAa,CACrE,MAAMC,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,eACpBA,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAQhBD,IAAaC,EAAQ,cAAc,OAAO,EAAE,MAAQD,GAExD,IAAIE,EACAC,EAAS,EACTC,EAAS,EACTC,EAAK,EAAGC,EAAK,EAEjB,OAAAC,IAEO,CACL,QAAAN,EACA,UAAYO,GAAc,CAAEN,EAASM,CAAY,CAClD,EAED,SAASC,EAAOC,EAAG,CACjBA,EAAE,eAAc,EAChBX,EAAOE,EAAQ,cAAc,OAAO,EAAE,KAAK,EAC3CU,GACD,CAED,SAASJ,GAAiB,CACxB,SAAS,iBAAiB,UAAWK,CAAS,EAC9CX,EAAQ,cAAc,MAAM,EAAE,iBAAiB,SAAUQ,CAAM,EAC/DR,EAAQ,cAAc,SAAS,EAAE,iBAAiB,QAAUS,GAAM,CAChEA,EAAE,eAAc,EAChBC,GACN,CAAK,EAEDV,EAAQ,cAAc,SAAS,EAAE,iBAAiB,QAAUS,GAAM,CAChED,EAAOC,CAAC,CACd,CAAK,EAEDT,EAAQ,iBAAiB,cAAgBS,GAAM,CAC7CP,EAASO,EAAE,QAASN,EAASM,EAAE,QAC/B,IAAIG,EAAoBf,EAAI,QAAQI,EAAO,UAAW,CAAA,EACtDG,EAAKQ,EAAkB,EAAIV,EAC3BG,EAAKO,EAAkB,EAAIT,EAC3B,OAAO,iBAAiB,cAAeU,EAAe,EAAI,EAC1D,OAAO,iBAAiB,YAAaC,EAAS,EAAI,CACxD,CAAK,CACF,CAED,SAASD,EAAcJ,EAAG,CACxB,MAAMM,EAAYlB,EAAI,UAAU,CAACY,EAAE,QAAUL,EAAIK,EAAE,QAAUJ,CAAE,CAAC,EAChEJ,EAAO,UAAUc,CAAS,CAC3B,CAED,SAASD,GAAU,CACjB,SAAS,oBAAoB,UAAWH,CAAS,EACjD,OAAO,oBAAoB,cAAeE,EAAe,EAAI,EAC7D,OAAO,oBAAoB,YAAaC,EAAS,EAAI,CACtD,CAED,SAASJ,GAAQ,CACfT,EAAO,OAAM,EACba,GACD,CAED,SAASH,EAAUF,EAAG,CAChBA,EAAE,MAAQ,WACZC,IACAD,EAAE,eAAc,EAEnB,CACH,CCvEe,SAASO,GAAkBnB,EAAK,CAC7C,IAAInB,EACJ,MAAMuC,EAAmB,CAAC,kBAAmB,0BAA0B,EAEvE,OAAAhD,GAAgB,EAAC,KAAKiD,GAAgB,CACpCrB,EAAI,UAAU,OAAO,EAAE,QAAQqB,CAAY,EAC3CxC,EAASwC,CACb,CAAG,EAEM,CACL,oBAAAC,EACA,UAAW,IAAMzC,CAClB,EAED,SAASyC,EAAoBV,EAAG1B,EAAe,CAC7C,MAAMqC,EAAyBH,EAAiB,OAAQI,GAAYxB,EAAI,SAASwB,CAAO,CAAC,EACnFC,EAAeF,EAAuB,OACxCvB,EAAI,sBAAsBY,EAAE,MAAO,CAAE,OAAQW,EAAwB,EACrE,GACJ,IAAIG,EAAQ,CAAE,EACd,GAAID,EAAa,OAAQ,CACvB,MAAMrC,EAAQqC,EAAa,CAAC,EAAE,WAC9BC,EAAM,KAAK,CACT,KAAM,QAAQtC,EAAM,IAAI,GACxB,MAAO,IAAMuC,EAAUF,EAAa,CAAC,EAAE,SAAS,YAAarC,CAAK,CAC1E,CAAO,CACP,MACMsC,EAAM,KAAK,CACT,KAAM,YACN,MAAO,IAAME,EAAShB,EAAE,OAAQ1B,CAAa,CACrD,CAAO,EAGH,OAAOwC,CACR,CAED,SAASE,EAAS5C,EAAQE,EAAe,CACvC,MAAM2C,EAAeC,GAAmB9B,EAAK+B,CAAI,EAE3C3B,EAAS,IAAI4B,EAAW,MAAM,CAAC,YAAa,EAAK,CAAC,EACxD5B,EAAO,cAAcyB,EAAa,OAAO,EACzCzB,EAAO,UAAUpB,CAAM,EACvBoB,EAAO,MAAMJ,CAAG,EAEhB6B,EAAa,UAAUzB,CAAM,EAE7B,SAAS2B,EAAKhD,EAAO,CACdA,IACLF,EAASC,GAAiBD,EAAQE,EAAOqB,EAAO,UAAW,EAAEJ,EAAI,UAAWd,CAAa,EACzFc,EAAI,UAAU,OAAO,EAAE,QAAQnB,CAAM,EACrCF,EAAI,KAAK,2BAA4B,EAAI,EAC1C,CACF,CAED,SAASgD,EAAU3C,EAAQiD,EAAe,CACxC,MAAMJ,EAAeC,GAAmB9B,EAAK+B,EAAME,EAAc,IAAI,EAE/D7B,EAAS,IAAI4B,EAAW,MAAM,CAAC,YAAa,EAAK,CAAC,EACxD5B,EAAO,cAAcyB,EAAa,OAAO,EACzCzB,EAAO,UAAUpB,CAAM,EACvBoB,EAAO,MAAMJ,CAAG,EAEhB6B,EAAa,UAAUzB,CAAM,EAE7B,SAAS2B,EAAKhD,EAAO,CACnBF,EAASS,GAAkB2C,EAAc,QAASpD,EAAQE,EAAOqB,EAAO,UAAW,EAAEJ,EAAI,QAAS,CAAA,EAClGA,EAAI,UAAU,OAAO,EAAE,QAAQnB,CAAM,EACrCF,EAAI,KAAK,2BAA4B,EAAI,CAC1C,CACF,CACH,CChEA,MAAMuD,GAAwB,UACxBC,GAA0B,UAC1BC,GAAqB,UACrBC,GAAsB,UACtBC,GAA2B,UAC3BC,GAA+B,UAC/BC,GAA+B,IAC/BC,EAAoB,EACpBC,EAAsB,kBACtBC,EAA8B,2BAC9BC,EAAuB,kCAEvBC,EAAoBC,GAAa,EAEjCC,EAAa,CAAE,MAAQ,EAC7BF,EAAkB,MAAM,QAASG,GAAQ,CACvCD,EAAW,KAAK,CAAC,KAAM,CAAC,MAAO,MAAM,EAAGC,EAAI,KAAK,EAAGA,EAAI,MAAM,CAChE,CAAC,EACDD,EAAW,KAAK,SAAS,EAEV,SAASE,IAAY,CAClC,MAAMjD,EAAM,IAAIgC,EAAW,IAAIkB,GAAiB,CAAA,EAChDlD,EAAI,WAAW,UACfA,EAAI,gBAAgB,kBACpB,MAAMmD,EAAiBC,KACvB,IAAIC,EACAC,EACAC,EAAgC,CAAA,EAChCC,EAA+B,CAAA,EAC/BC,EAAyB,CAAA,EACzBC,EAAwB,CAAA,EACxBC,EAA0B,EAG9B3D,EAAI,GAAG,OAAQ,IAAM,CACnBA,EAAI,SAASmD,EAAgB,cAAc,EAE3CG,EAAcnC,GAAkBnB,CAAG,EACnC4D,IACAC,IACAC,IACAC,GACJ,CAAG,EAED/D,EAAI,GAAG,cAAgBY,GAAM,CAC3BjC,EAAI,KAAK,cAAc,EAEvB,IAAIqF,EAAKC,EAAuBrD,EAAE,KAAK,EACvC,GAAI,CAACoD,EAAI,OAET,MAAME,EAAmB,CACvB,MAAOZ,EAAY,oBAAoB1C,EAAGoD,EAAG,EAAE,EAC/C,KAAMpD,EAAE,MAAM,EAAI,KAClB,IAAKA,EAAE,MAAM,EAAI,IACvB,EAEUuD,EAAcC,GAAgBxD,EAAE,KAAK,EAC3C,GAAIuD,EAAa,CACf,IAAIE,EAAOF,EAAY,WAAW,MAC9BG,EAAQD,EAAK,MAAM,GAAG,EAC1B,MAAME,EAAcD,EAAMA,EAAM,OAAS,CAAC,GAAKD,EAE/CH,EAAiB,MAAM,KAAK,CAC1B,KAAM,uBAAyBK,EAC/B,MAAO,IAAM,CACXC,EAAYL,CAAW,EACvBM,EAAoB7D,EAAE,MAAOyD,CAAI,EACjC1F,EAAI,KAAK,gBAAiB0F,EAAML,EAAG,EAAE,CACtC,CACT,CAAO,CACF,CAEDrF,EAAI,KAAK,oBAAqBuF,CAAgB,CAClD,CAAG,EAEDlE,EAAI,GAAG,YAAa,IAAM,CAa5B,CAAG,EAEDA,EAAI,GAAG,QAAUY,GAAM,CACrBjC,EAAI,KAAK,mBAAmB,EAC5B,MAAMwF,EAAcC,GAAgBxD,EAAE,KAAK,EAC3C,GAAI,CAACuD,EAAa,OAClB,MAAMO,EAAOP,EAAY,WAAW,MACpC,GAAI,CAACO,EAAM,OACXF,EAAYL,CAAW,EAEvB,MAAMQ,EAAkB/D,EAAE,cAAc,OACxC6D,EAAoB7D,EAAE,MAAO8D,EAAM,CAACC,CAAe,CACvD,CAAG,EACD,MAAMC,EAAoB,MAAMvG,EAAO,aAAa,EAAE,KAAMwG,GAAQA,EAAI,KAAI,CAAE,EACxEC,EAAeF,EAAkB,KAAMG,IAC1B,MAAM,QAAQA,GAAA,YAAAA,EAAY,QAAQ,EAAIA,EAAW,SAAW,IAE1E,IAAKC,GAAY,SAChB,MAAMC,GAAOC,GAAAC,EAAAH,GAAA,YAAAA,EAAS,WAAT,YAAAG,EAAmB,cAAnB,YAAAD,EAAiC,GAC9C,GAAI,CAAC,MAAM,QAAQD,CAAI,GAAK,CAACA,EAAK,OAAQ,OAAO,KACjD,MAAMG,EAAOC,GAAcJ,CAAI,EAC/B,MAAO,CACL,GAAID,EAAQ,GACZ,KAAAC,EACA,KAAAG,CACV,CACA,CAAO,EACA,OAAO,OAAO,CAClB,EAED,MAAO,CACL,IAAApF,EACA,SAAU,CACRA,EAAI,OAAM,CAEX,EACD,YAAAsF,GACA,aAAAC,GACA,eAAAC,GACA,iBAAAC,GACA,yBAAAC,EACA,0BAAAC,GACA,sBAAAC,GACA,gBAAAC,GACA,iBAAAC,EACA,aAAAC,EACA,yBAAAC,CACD,EAED,SAASD,EAAaE,EAAKC,EAAK,CAC9B,MAAMC,EAAW,OAAOF,CAAG,EACrBG,EAAW,OAAOF,CAAG,EAC3B,MAAI,CAAC,OAAO,SAASC,CAAQ,GAAK,CAAC,OAAO,SAASC,CAAQ,EAClD,QAAQ,QAAQ,MAAS,EAE3BtB,EAAa,KAAMuB,GAAUC,EAAoBD,EAAOF,EAAUC,CAAQ,CAAC,CACnF,CAED,SAASJ,EAAyBO,EAAc,GAAI,CAClD,MAAI,CAAC,MAAM,QAAQA,CAAW,GAAK,CAACA,EAAY,OACvC,QAAQ,QAAQ,CAAA,CAAE,EAEpBzB,EAAa,KAAMuB,GACjBE,EAAY,IAAKC,GAAS,CAC/B,GAAI,CAAC,MAAM,QAAQA,CAAI,GAAKA,EAAK,SAAW,EAAG,OAC/C,MAAMP,EAAM,OAAOO,EAAK,CAAC,CAAC,EACpBN,EAAM,OAAOM,EAAK,CAAC,CAAC,EAC1B,GAAI,GAAC,OAAO,SAASP,CAAG,GAAK,CAAC,OAAO,SAASC,CAAG,GACjD,OAAOI,EAAoBD,EAAOJ,EAAKC,CAAG,CAClD,CAAO,CACF,CACF,CAED,SAASI,EAAoBD,EAAQ,GAAIJ,EAAKC,EAAK,CACjD,QAAS,EAAI,EAAG,EAAIG,EAAM,OAAQ,GAAK,EAAG,CACxC,MAAMI,EAASJ,EAAM,CAAC,EACtB,GAAKK,GAAoBT,EAAKC,EAAKO,EAAO,IAAI,GAC1CE,GAAqBF,EAAO,KAAMR,EAAKC,CAAG,EAC5C,OAAOO,EAAO,EAEjB,CAEF,CAED,SAASjC,EAAYL,EAAa,OAChC,MAAMO,EAAOP,EAAY,WAAW,MACpC,GAAI,CAACO,EAAM,OACX,KAAM,CAACwB,EAAKU,CAAG,EAAIzC,EAAY,SAAS,YACxCxF,EAAI,KAAK,cAAc,EACvBA,EAAI,KAAK,gBAAiB,CACxB,KAAM+F,EACN,IAAAwB,EACA,IAAAU,EACA,SAASzB,EAAAhB,EAAY,aAAZ,YAAAgB,EAAwB,MACvC,CAAK,CACF,CAED,SAASW,GAAmB,CAC1B,OAAOxC,EAAY,WACpB,CAED,SAASoC,GAA2B,CAClCrC,GAAA,MAAAA,EAAsB,SACtBF,EAAe,MAAK,EACpBK,EAA+B,CAAA,EAC/BK,GACD,CAED,SAAS8B,IAA4B,CACnCpC,EAAgC,CAAA,EAChCK,GACD,CAED,SAASgC,IAAwB,CAC/BjC,GAA2B,EAC3BF,EAAyB,CAAA,EACzBC,EAAwB,CAAA,EACxBI,IACAC,GACD,CAED,SAAS8B,IAAkB,CACzBxC,GAAA,MAAAA,EAAsB,SACtBF,EAAe,MAAK,EACpBI,EAAgC,CAAA,EAChCC,EAA+B,CAAA,EAC/BC,EAAyB,CAAA,EACzBC,EAAwB,CAAA,EACxBC,GAA2B,EAC3BC,IACAC,IACAC,IACAC,GACD,CAED,SAASuB,GAAYuB,EAAYC,EAAUC,EAAmB,GAAO,CACnE,MAAMC,EAA2B,IAAM,CACrC,MAAMC,EAAiBjH,EAAI,QAAQ8G,EAAS,MAAM,EAClDrC,EAAoBwC,EAAgBJ,CAAU,CACpD,EAEI,GAAIE,EAAkB,CACpB/G,EAAI,OAAO8G,CAAQ,EACnBE,IACA,MACD,CAEDhH,EAAI,KAAK,UAAWgH,CAAwB,EAC5ChH,EAAI,MAAM8G,CAAQ,CACnB,CAED,SAASvB,GACP2B,EAAQ,CAAE,EACV,CAAE,QAAAC,EAAU,GAAI,QAAAC,EAAU,EAAG,iBAAAL,EAAmB,EAAK,EAAK,CAAE,EAC5D,CACA,MAAMR,EAAcW,EAAM,IAAIG,CAAkB,EAAE,OAAO,OAAO,EAChE,GAAI,CAACd,EAAY,OAAQ,OAEzB,IAAIe,EAAS,IACTC,EAAS,IACTC,EAAS,KACTC,EAAS,KASb,GAPAlB,EAAY,QAAQ,CAAC,CAACN,EAAKC,CAAG,IAAM,CAC9BD,EAAMqB,IAAQA,EAASrB,GACvBC,EAAMqB,IAAQA,EAASrB,GACvBD,EAAMuB,IAAQA,EAASvB,GACvBC,EAAMuB,IAAQA,EAASvB,EACjC,CAAK,EAEGoB,IAAWE,GAAUD,IAAWE,EAAQ,CAC1C,MAAMX,EAAW,CACf,OAAQ,CAACQ,EAAQC,CAAM,EACvB,KAAMH,CACd,EACUL,EACF/G,EAAI,OAAO8G,CAAQ,EAEnB9G,EAAI,MAAM8G,CAAQ,EAEpB,MACD,CAED,MAAMA,EAAW9G,EAAI,gBACnB,CACE,CAACsH,EAAQC,CAAM,EACf,CAACC,EAAQC,CAAM,CAChB,EACD,CACE,QAAAN,EACA,QAAAC,CACD,CACP,EACSN,IAEDC,EACF/G,EAAI,OAAO8G,CAAQ,EAEnB9G,EAAI,MAAM8G,CAAQ,EAErB,CAED,SAASO,EAAmBK,EAAO,GAAI,CACrC,MAAMnB,EAAc,MAAM,QAAQmB,EAAK,WAAW,EAC9CA,EAAK,YACL,CAACA,EAAK,IAAKA,EAAK,GAAG,EACvB,GAAI,CAAC,MAAM,QAAQnB,CAAW,GAAKA,EAAY,SAAW,EAAG,OAAO,KAEpE,MAAMN,EAAM,OAAOM,EAAY,CAAC,CAAC,EAC3BL,EAAM,OAAOK,EAAY,CAAC,CAAC,EACjC,MAAI,CAAC,OAAO,SAASN,CAAG,GAAK,CAAC,OAAO,SAASC,CAAG,EAAU,KACpD,CAACD,EAAKC,CAAG,CACjB,CAED,SAASV,GAAe0B,EAAQ,GAAI,CAClC7D,GAAA,MAAAA,EAAsB,SACtBF,EAAe,MAAK,EACpBI,EAAgC2D,EAC7B,IAAKQ,GAAS,CACb,MAAMnB,EAAcc,EAAmBK,CAAI,EAC3C,OAAKnB,EACE,CACL,KAAM,UACN,SAAU,CAAE,KAAM,QAAS,YAAAA,CAAa,EACxC,WAAY,CACV,MAAOmB,EAAK,OAAStF,GACrB,KAAMsF,EAAK,MAAQA,EAAK,MAAQ,GAChC,WAAYA,EAAK,YAAc,OAC/B,cAAeA,EAAK,eAAiB,OACrC,SAAUA,EAAK,UAAY,GAC3B,KAAMA,EAAK,MAAQjF,EAAoB,CACxC,CACX,EAZiC,IAajC,CAAO,EACA,OAAO,OAAO,EAEjBmB,GACD,CAED,SAASA,GAA4B,CACnC,MAAM+D,EAAS3H,EAAI,UAAU,2BAA2B,EACnD2H,IAELA,EAAO,QAAQ,CACb,KAAM,oBACN,SAAUpE,CAChB,CAAK,EACDvD,EAAI,OAAM,EACX,CAED,SAAS6D,GAA2B,CAClC,MAAM8D,EAAS3H,EAAI,UAAU,gBAAgB,EACxC2H,IAELA,EAAO,QAAQ,CACb,KAAM,oBACN,SAAUnE,CAChB,CAAK,EACDxD,EAAI,OAAM,EACX,CAED,SAAS8D,GAAgC,CACvC,MAAM6D,EAAS3H,EAAI,UAAU,kBAAkB,EAC1C2H,IAELA,EAAO,QAAQ,CACb,KAAM,oBACN,SAAUlE,CAChB,CAAK,EACDzD,EAAI,OAAM,EACX,CAED,SAASyF,GAAiBmC,EAAW,GAAI,CACvC,MAAMC,EAAiB,IAAI,KACxB,MAAM,QAAQD,CAAQ,EAAIA,EAAW,CAAE,GACrC,OAAQE,GAA2BA,GAAO,IAAI,EAC9C,IAAKA,GAAO,OAAOA,CAAE,CAAC,CAC/B,EACUC,EAAY,EAAEpE,EAEpB,GAAI,CAACkE,EAAe,KAAM,CACxBpE,EAAyB,CAAA,EACzBC,EAAwB,CAAA,EACxBI,IACAC,IACA,MACD,CACDL,EAAwB,MAAM,KAAKmE,CAAc,EACjD9D,IAEAa,EACG,KAAMG,GAAe,CACpB,GAAIgD,IAAcpE,EAAyB,OAE3CF,GADiB,MAAM,QAAQsB,GAAA,YAAAA,EAAY,QAAQ,EAAIA,EAAW,SAAW,IAC3C,OAAQC,GACxC6C,EAAe,IAAI,OAAO7C,GAAA,YAAAA,EAAS,EAAE,CAAC,CAChD,EACQlB,GACR,CAAO,EACA,MAAOkE,GAAU,CACZD,IAAcpE,IAClB,QAAQ,MAAMqE,CAAK,EACnBvE,EAAyB,CAAA,EACzBC,EAAwB,CAAA,EACxBI,IACAC,IACR,CAAO,CACJ,CAED,SAASA,GAAiC,CACxC,GAAI,CAAC/D,EAAI,SAAS0C,CAAmB,EAAG,OAExC,MAAMuF,EAAqBC,IACrBC,EAAuBC,KACvBC,EAAoB3E,EAAsB,OAAS,EACnD4E,EAAuBC,GAAsC7E,CAAqB,EAClF8E,EAA4BH,EAC9B,CAAC,MAAOF,EAAsB,CAAC,IAAKG,CAAoB,CAAC,EACzDH,EAcJ,GAZInI,EAAI,SAAS4C,CAAoB,GACnC5C,EAAI,UAAU0C,EAAqBE,CAAoB,EAEzD5C,EAAI,kBAAkB0C,EAAqB,EAAG,EAAE,EAChD1C,EAAI,UAAU0C,EAAqB8F,CAAyB,EAC5DxI,EAAI,kBAAkB0C,EAAqB,YAAauF,CAAkB,EAC1EjI,EAAI,kBAAkB0C,EAAqB,qBAAsB,EAAK,EACtE1C,EAAI,kBAAkB0C,EAAqB,wBAAyB,EAAK,EACzE1C,EAAI,iBAAiB0C,EAAqB,aAAcG,EAAkB,gBAAgB,EAC1F7C,EAAI,iBAAiB0C,EAAqB,kBAAmBG,EAAkB,oBAAoB,EACnG7C,EAAI,iBAAiB0C,EAAqB,kBAAmBG,EAAkB,oBAAoB,EAE/F,CAACwF,EAAmB,CACtBI,KACA,MACD,CAEDC,KACK1I,EAAI,SAAS2C,CAA2B,IAE7C3C,EAAI,kBAAkB2C,EAA6B,EAAG,EAAE,EACxD3C,EAAI,UAAU2C,EAA6B2F,CAAoB,EAC/DtI,EAAI,kBACF2C,EACA,YACAuF,EAA2C1F,EAA4B,CAC7E,EACIxC,EAAI,kBAAkB2C,EAA6B,qBAAsB,EAAI,EAC7E3C,EAAI,kBAAkB2C,EAA6B,wBAAyB,EAAI,EAChF3C,EAAI,iBAAiB2C,EAA6B,aAAcL,EAAwB,EACxFtC,EAAI,iBAAiB2C,EAA6B,kBAAmBJ,EAA4B,EACjGvC,EAAI,iBACF2C,EACA,kBACAgG,GAAgC,CACtC,EACI3I,EAAI,UAAU2C,CAA2B,EAC1C,CAED,SAAS+F,IAAkC,CACzC,GAAI1I,EAAI,SAAS2C,CAA2B,EAAG,OAE/C,MAAMiG,EAAkB,CACtB,GAAIjG,EACJ,KAAM,SACN,OAAQ,QACR,OAAQ,CACN,YAAa,CAAE,0BAA4B,EAC3C,YAAauF,EAA4C,EACzD,kBAAmB,CAAC,MAAO,YAAY,EACvC,aAAc,SACd,iBAAkB,EAClB,mBAAoB,IACpB,sBAAuB,EACvB,qBAAsB,GACtB,wBAAyB,EAC1B,EACD,MAAO,CACL,aAAc5F,GACd,kBAAmBC,GACnB,kBAAmBoG,GAAgC,CACpD,CACP,EAEI,GAAI3I,EAAI,SAAS4C,CAAoB,EAAG,CACtC5C,EAAI,SAAS4I,EAAiBhG,CAAoB,EAClD,MACD,CAED5C,EAAI,SAAS4I,CAAe,CAC7B,CAED,SAASH,IAAkC,CACpCzI,EAAI,SAAS2C,CAA2B,GAC7C3C,EAAI,YAAY2C,CAA2B,CAC5C,CAED,SAASsB,EAAuB4E,EAAO,CAErC,OADsB7I,EAAI,sBAAsB6I,EAAO,CAAE,OAAQ,CAAC,eAAe,CAAC,CAAE,EAC/D,CAAC,CACvB,CAED,SAASpE,EAAoBoE,EAAOnE,EAAMoE,EAAiB,GAAM,CAC/D,MAAMC,EAAY9E,EAAuB4E,CAAK,EAC9C,GAAI,CAACE,EAAW,OAChB,MAAMC,EAAUD,EAAU,GAC1B,GAAIC,IAAY,OAAW,OAE3B,MAAMC,EAAYC,GAAoBH,EAAU,UAAU,EAC1D,IAAII,EAAqBC,GAAsBH,CAAS,EACxD9F,EAAe,MAAK,EACpBE,GAAA,MAAAA,EAAsB,SACtB,IAAIgG,EAAc,GACdC,EAAmB,CACrB,KAAM,oBACN,SAAU,CAAE,CAClB,EAEIjG,EAAuBkG,GAAmBP,CAAO,EAAE,KAAKQ,GAAc,CACpE,GAAIH,EAAa,OACjB,IAAII,EAAkB,CAAA,EAClBC,EACAC,EAA0B,IAAI,IAClC3J,EAAI,oBAAoB,gBAAiB,CACvC,YAAa,SACb,OAAQ,CAAC,KAAM,SAAUgJ,CAAO,CACxC,CAAO,EAAE,QAAQtE,GAAQ,CACjB,MAAM1F,EAAS0F,EAAK,SAAS,YACvBkF,EAAO,OAAOlF,EAAK,WAAW,IAAI,EACxCiF,EAAwB,IAAIjF,EAAK,WAAW,MAAO,CACjD,OAAA1F,EACA,KAAM,OAAO,SAAS4K,CAAI,GAAKA,EAAO,EAAIA,EAAOnH,CAC3D,CAAS,CACT,CAAO,EAED,MAAMoH,GAAmBC,GAAW,OAClC,MAAMC,IAAgB5E,EAAAqE,EAAW,QAAQM,CAAM,IAAzB,YAAA3E,EAA4B,OAAQ,GACpDyE,EAAO,OAAOG,EAAc,MAAQA,EAAc,CAAC,EACzD,OAAO,OAAO,SAASH,CAAI,GAAKA,EAAO,EAAIA,EAAOnH,CAC1D,EAEM+G,EAAW,YAAYQ,GAAQ,QAC7B,IAAI7E,GAAA6E,EAAK,OAAL,MAAA7E,GAAW,GAAK2D,EAAgB,OACpC,MAAMmB,EAAeN,EAAwB,IAAIK,EAAK,MAAM,GAAK,CAC/D,OAAQR,EAAW,QAAQQ,EAAK,MAAM,EAAE,KAAK,EAC7C,KAAMH,GAAgBG,EAAK,MAAM,CAC3C,EACcE,EAAaP,EAAwB,IAAIK,EAAK,IAAI,GAAK,CAC3D,OAAQR,EAAW,QAAQQ,EAAK,IAAI,EAAE,KAAK,EAC3C,KAAMH,GAAgBG,EAAK,IAAI,CACzC,EACcG,EAAUF,EAAa,OACvBG,EAAQF,EAAW,OAEnBG,GAAOrI,EAAW,mBAAmB,WAAWmI,CAAO,EACvDG,GAAKtI,EAAW,mBAAmB,WAAWoI,CAAK,EACnDG,GAAe7F,IAASsF,EAAK,QAAUtF,IAASsF,EAAK,KACrDQ,GAAO,CACX,KAAM,CAACH,GAAK,EAAGA,GAAK,CAAC,EACrB,GAAI,CAACC,GAAG,EAAGA,GAAG,CAAC,EACf,MAAOC,GAAe,WAAapB,CACpC,EAED,GAAIoB,GAAc,CAGhB,GAFAd,EAAgB,KAAKe,EAAI,EAErB,CAACd,EAAqB,CACxBA,EAAsBhF,IAASsF,EAAK,OAASG,EAAUC,EACvD,MAAMK,GAAkB/F,IAASsF,EAAK,OAASC,EAAa,KAAOC,EAAW,KAC9EZ,EAAiB,SAAS,KAAK,CAC7B,KAAM,UACN,SAAU,CAAC,KAAM,QAAS,YAAaI,CAAmB,EAC1D,WAAY,CAAC,MAAOxH,GAAuB,KAAMwC,EAAM,WAAYuE,EAAW,cAAe,QAAS,SAAU,IAAK,KAAMwB,EAAe,CACxJ,CAAa,CACF,CACD,IAAIC,GAAYhG,IAASsF,EAAK,OAASA,EAAK,KAAOA,EAAK,OACxD,MAAMW,GAAgBjG,IAASsF,EAAK,OAASE,EAAW,KAAOD,EAAa,KAE5EX,EAAiB,SAAS,KAAK,CAC7B,KAAM,UACN,SAAU,CAAC,KAAM,QAAS,YAAa5E,IAASsF,EAAK,OAASI,EAAQD,CAAO,EAC7E,WAAY,CAAC,MAAOhI,GAAyB,KAAMuI,GAAW,WAAYzB,EAAW,cAAe,QAAS,SAAU,GAAK,KAAM0B,EAAa,CAC3J,CAAW,CACX,MAAexH,EAAe,QAAQqH,EAAI,CAC1C,CAAO,EACDf,EAAgB,QAAQe,GAAQ,CAC9BrH,EAAe,QAAQqH,CAAI,CACnC,CAAO,EACDhH,EAA+B8F,EAAiB,SAChDzF,GACN,CAAK,EACDR,EAAqB,OAAS,IAAM,CAACgG,EAAc,EAAI,CACxD,CAED,SAASjF,GAAgByE,EAAO,CAC9B,IAAI+B,EAAQ,GACRC,EAAS,GACb,MAAMC,EAAW9K,EAAI,sBAAsB,CACzC,CAAC6I,EAAM,EAAI+B,EAAQ,EAAG/B,EAAM,EAAIgC,EAAS,CAAC,EAC1C,CAAChC,EAAM,EAAI+B,EAAQ,EAAG/B,EAAM,EAAIgC,EAAS,CAAC,CAC3C,EAAE,CAAE,OAAQ,CAAC,cAAc,CAAG,CAAA,EAC/B,GAAI,CAACC,EAAS,OAAQ,OACtB,IAAIC,EAAW,IACX5G,EAAc,KAClB,OAAA2G,EAAS,QAAQ9F,GAAW,CAC1B,IAAIgG,EAAWhG,EAAQ,SAAS,YAC5BzE,EAAKyK,EAAS,CAAC,EAAInC,EAAM,EACzBrI,EAAKwK,EAAS,CAAC,EAAInC,EAAM,EACzBoC,EAAI1K,EAAKA,EAAKC,EAAKA,EACnByK,EAAIF,IACNA,EAAWE,EACX9G,EAAca,EAEtB,CAAK,EACMb,CACR,CACH,CAEA,SAASjB,IAAkB,CACzB,MAAO,CACL,KAAM,GACN,UAAW,MACX,OAAQ,CAAC,EAAG,CAAC,EACb,KAAM,EACN,MAAO,CACL,QAAS,EACT,OAAQ7E,EAAO,aACf,QAAS,CACP,iBAAkB,CAAE,KAAM,UAAW,KAAMA,EAAO,aAAgB,EAClE,gBAAiB,CACf,KAAM,SACN,MAAO,CAACA,EAAO,gBAAgB,EAE/B,QAAS,EACT,QAAS,EACT,OAAQ,CAAC,SAAU,SAAS,CAAC,CAC9B,EACD,MAAS,CACP,KAAM,UACN,KAAM,CACJ,KAAM,oBACN,SAAU,CAAE,CACb,CACF,EACD,iBAAkB,CAChB,KAAM,UACN,KAAM,CACJ,KAAM,oBACN,SAAU,CAAE,CACb,CACF,EACD,4BAA6B,CAC3B,KAAM,UACN,KAAM,CACJ,KAAM,oBACN,SAAU,CAAE,CACb,CACF,EACD,mBAAoB,CAClB,KAAM,UACN,KAAM,CACJ,KAAM,oBACN,SAAU,CAAE,CACb,CACF,CACF,EACD,OAAQ,CACN,CACA,GAAM,aACN,KAAQ,aACR,MAAS,CACP,mBAAoBwE,EAAkB,UACvC,CACF,EACC,CACE,GAAM,gBACN,KAAQ,OACR,OAAU,iBACV,OAAU,CAAC,KAAM,QAAS,SAAS,EACnC,MAAS,CACP,aAAcE,CACf,CACF,EACD,CACE,GAAM,iCACN,KAAQ,OACR,OAAU,mBACV,MAAS,CACP,aAAcV,GACd,aAAc,CACZ,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,EACH,EAAG,IACH,GAAI,CACL,EACD,eAAgB,EACjB,CACF,EACD,CACE,GAAM,mBACN,KAAQ,OACR,OAAU,iBACV,OAAU,CACR,WAAc,MACf,EACD,MAAS,CACP,aAAc,OACd,aAAc,CACf,CACF,EACD,CACE,GAAM,eACN,KAAQ,SACR,OAAU,gBACV,eAAgB,SAChB,OAAU,CAAC,KAAM,QAAS,OAAO,EACjC,MAAS,CACP,eAAgBQ,EAAkB,YAClC,iBAAkB,CAChB,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,GACH,GAAI,EACL,EACD,sBAAuBA,EAAkB,kBACzC,sBAAuB,EACvB,wBAAyB,CACvB,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,EACH,GAAI,EACL,EACD,gBAAiB,CACf,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,EAAE,EAC7B,GAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,GAAG,CAC/B,CACF,CACF,EACD,CACE,GAAM,cACN,KAAQ,SACR,OAAU,gBACV,eAAgB,SAChB,OAAU,CAAC,KAAM,CAAC,MAAM,EAAG,CAAC,EAC5B,OAAU,CACR,YAAa,CAAE,0BAA4B,EAC3C,aAAc,CAAC,QAAS,CAAC,MAAO,OAAO,EAAG,CAAC,IAAK,CAAC,WAAY,IAAK,CAAC,MAAO,OAAO,CAAC,EAAG,CAAC,CAAC,EACvF,cAAe,MACf,iBAAkB,GAClB,kBAAmB,CAAC,IAAK,EAAG,CAAC,MAAO,MAAM,CAAC,EAC3C,iBAAkB,IAClB,cAAe,CAAC,EAAG,EAAG,EACtB,YAAa,CACX,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,CAAC,EAC5B,GAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,CAAC,CAC7B,CACF,EACD,MAAS,CACP,aAAcA,EAAkB,kBAChC,kBAAmBA,EAAkB,sBACrC,kBAAmBA,EAAkB,qBACtC,CACF,EACD,CACE,GAAM,uBACN,KAAQ,SACR,OAAU,iBACV,MAAS,CACP,eAAgB,CAAC,MAAO,OAAO,EAC/B,gBAAiB,CACf,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,CAAC,MAAO,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,EAAG,CAAC,EACzC,EAAG,CAAC,MAAO,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,GAAI,CAAC,EAC1C,GAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,GAAG,CAC/B,EACD,sBAAuB,UACvB,sBAAuB,CACrB,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,GACH,EAAG,IACH,GAAI,CACL,EACD,wBAAyB,EAC1B,CACF,EACD,CACE,GAAM,8BACN,KAAQ,SACR,OAAU,iBACV,OAAU,CACR,YAAa,CAAE,0BAA4B,EAC3C,aAAc,CAAC,MAAO,MAAM,EAC5B,cAAe,MACf,iBAAkB,GAClB,kBAAmB,CAAC,IAAK,EAAG,CAAC,MAAO,UAAU,CAAC,EAC/C,iBAAkB,IAClB,cAAe,CAAC,EAAG,EAAG,EACtB,YAAa,CACX,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,CAAC,MAAO,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,GAAG,CAAC,EACzC,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,CAAC,EAC3B,GAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,CAAC,CAC7B,CACF,EACD,MAAS,CACP,aAAc,OACd,kBAAmB,CAAC,MAAO,OAAO,EAClC,kBAAmB,CACpB,CACF,EAET,CACI,GAAM,kBAEN,QAAW,GACX,KAAQ,SACR,OAAU,QACV,OAAU,CACN,YAAa,CAAE,uBAAyB,EACxC,YAAaqF,EAA4C,EACzD,kBAAmB,CAAC,MAAO,YAAY,EACvC,aAAc,SACd,iBAAkB,EAClB,mBAAoB,IACpB,sBAAuB,CAC1B,EACD,MAAS,CACP,aAAcrF,EAAkB,iBAChC,kBAAmBA,EAAkB,qBACrC,kBAAmBA,EAAkB,oBACtC,EACD,OAAUuF,GAA0C,CACxD,EACQ,CACE,GAAM,kCACN,KAAQ,SACR,OAAU,4BACV,MAAS,CACP,eAAgB,CAAC,MAAO,OAAO,EAC/B,gBAAiB,CACf,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,CAAC,MAAO,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,EAAG,CAAC,EACzC,EAAG,CAAC,MAAO,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,GAAI,CAAC,EAC1C,GAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,GAAG,CAC/B,EACD,sBAAuB,UACvB,sBAAuB,CACrB,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,GACH,EAAG,IACH,GAAI,CACL,EACD,wBAAyB,EAC1B,CACF,EACD,CACE,GAAM,yCACN,KAAQ,SACR,OAAU,4BACV,OAAU,CACR,YAAa,CAAE,0BAA4B,EAC3C,aAAc,CAAC,MAAO,MAAM,EAC5B,cAAe,MACf,iBAAkB,GAClB,kBAAmB,CAAC,IAAK,EAAG,CAAC,MAAO,UAAU,CAAC,EAC/C,iBAAkB,IAClB,cAAe,CAAC,EAAG,EAAG,EACtB,qBAAsB,GACtB,YAAa,CACX,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,CAAC,MAAO,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,CAAC,CAAC,EACvC,EAAG,CAAC,MAAO,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,GAAG,CAAC,EACzC,EAAG,CAAC,MAAO,EAAG,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,GAAG,CAAC,EACzC,GAAI,CAAC,MAAO,GAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,EAAG,CAAC,EAC3C,GAAI,CAAC,IAAK,CAAC,MAAO,MAAM,EAAG,CAAG,CAC/B,CACF,EACD,MAAS,CACP,aAAc,OACd,kBAAmB,CAAC,MAAO,OAAO,EAClC,kBAAmB,CACpB,CACF,EACD,CACE,GAAM,4BACN,KAAQ,OACR,OAAU,mBACV,OAAU,CACR,YAAa,QACb,WAAY,OACb,EACD,MAAS,CACP,aAAc,UACd,aAAc,CACZ,cACA,CAAC,QAAQ,EACT,CAAC,MAAM,EACP,EAAG,IACH,EAAG,IACH,GAAI,EACJ,GAAI,GACL,EACD,eAAgB,GACjB,CACF,CACF,CACF,CACL,CACA,CAEA,SAASc,GAAoBgC,EAAmB,CAC9C,UAAWC,KAAStI,EAAkB,MACpC,GAAIsI,EAAM,QAAUD,EAAkB,KACpC,OAAOC,EAAM,OAGjB,OAAOD,EAAkB,IAC3B,CAEA,SAAS7F,GAAcJ,EAAO,GAAI,CAChC,IAAIqC,EAAS,IACTC,EAAS,IACTC,EAAS,KACTC,EAAS,KAEb,OAAAxC,EAAK,QAAS4D,GAAU,CACtB,GAAI,CAAC,MAAM,QAAQA,CAAK,GAAKA,EAAM,OAAS,EAAG,OAC/C,MAAM5C,EAAM,OAAO4C,EAAM,CAAC,CAAC,EACrB3C,EAAM,OAAO2C,EAAM,CAAC,CAAC,EACvB,CAAC,OAAO,SAAS5C,CAAG,GAAK,CAAC,OAAO,SAASC,CAAG,IAC7CD,EAAMqB,IAAQA,EAASrB,GACvBC,EAAMqB,IAAQA,EAASrB,GACvBD,EAAMuB,IAAQA,EAASvB,GACvBC,EAAMuB,IAAQA,EAASvB,GAC/B,CAAG,EAEM,CAACoB,EAAQC,EAAQC,EAAQC,CAAM,CACxC,CAEA,SAASf,GAAoBT,EAAKC,EAAKkF,EAAS,CAAA,EAAI,CAClD,MAAI,CAAC,MAAM,QAAQA,CAAM,GAAKA,EAAO,SAAW,EAAU,GACnDnF,GAAOmF,EAAO,CAAC,GAAKnF,GAAOmF,EAAO,CAAC,GAAKlF,GAAOkF,EAAO,CAAC,GAAKlF,GAAOkF,EAAO,CAAC,CACpF,CAEA,SAAS7C,GAAsC8C,EAAW,GAAI,CAC5D,MAAO,CACL,KACA,CAAC,YAAa,CAAC,MAAO,SAAS,CAAC,EAChC,CAAC,UAAWA,CAAQ,CACxB,CACA,CAEA,SAASnD,EAA2CoD,EAAQ,EAAG,CAC7D,MAAMC,EAAY,OAAO,SAASD,CAAK,GAAKA,EAAQ,EAAIA,EAAQ,EAChE,MAAO,CACL,cACA,CAAE,eAAgB,GAAK,EAAG,GAAK,CAAG,EAClC,CAAC,MAAM,EACP,EAAG,CACD,IACAC,EACA,CACE,OACA,CAAC,MAAO,YAAY,EAAG,GACvB,EAAG,GACH,EAAG,EACJ,CACF,EACD,EAAG,CACD,IACAA,EACA,CACE,OACA,CAAC,MAAO,YAAY,EAAG,GACvB,EAAG,GACH,EAAG,EACJ,CACF,CACL,CACA,CAEA,SAASnD,IAA2C,CAClD,MAAO,CACL,KACA,CAAC,MAAO,YAAY,EACpB,CAAC,IAAK,CAAC,MAAM,EAAG,CAAC,CACrB,CACA,CAEA,SAASO,IAAiC,CACxC,OAAO,KAAK,IAAI,IAAK9F,EAAkB,qBAAuB,GAAI,CACpE,CAEA,SAAS2I,GAAeC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAU,KAAM,CAC9D,MAAMxL,EAAKsL,EAAKF,EACVnL,EAAKsL,EAAKF,EACVI,GAASP,EAAKE,GAAMnL,GAAMkL,EAAKE,GAAMrL,EAC3C,GAAI,KAAK,IAAIyL,CAAK,EAAID,EAAS,MAAO,GAEtC,MAAME,EAAO,KAAK,IAAIN,EAAIE,CAAE,EAAIE,EAC1BG,EAAO,KAAK,IAAIP,EAAIE,CAAE,EAAIE,EAC1BI,EAAO,KAAK,IAAIP,EAAIE,CAAE,EAAIC,EAC1BK,EAAO,KAAK,IAAIR,EAAIE,CAAE,EAAIC,EAChC,OAAON,GAAMQ,GAAQR,GAAMS,GAAQR,GAAMS,GAAQT,GAAMU,CACzD,CAEA,SAASzF,GAAqB1B,EAAMoH,EAAIC,EAAI,CACxC,IAAIC,EAAI,GACR,QAASC,EAAI,EAAGC,EAAIxH,EAAK,OAAS,EAAGuH,EAAIvH,EAAK,OAAQwH,EAAID,IAAK,CAC3D,MAAME,EAAKzH,EAAKuH,CAAC,EACXG,EAAK1H,EAAKwH,CAAC,EACjB,GAAIjB,GAAea,EAAIC,EAAII,EAAG,CAAC,EAAGA,EAAG,CAAC,EAAGC,EAAG,CAAC,EAAGA,EAAG,CAAC,CAAC,EACjD,MAAO,GAELD,EAAG,CAAC,EAAIJ,GAASK,EAAG,CAAC,EAAIL,GAASD,GAAMM,EAAG,CAAC,EAAID,EAAG,CAAC,IAAMJ,EAAKI,EAAG,CAAC,IAAMC,EAAG,CAAC,EAAID,EAAG,CAAC,GAAKA,EAAG,CAAC,IAChGH,EAAI,CAACA,EAEZ,CACD,OAAOA,CACX"}